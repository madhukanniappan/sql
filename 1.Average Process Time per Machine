https://leetcode.com/problems/average-time-of-process-per-machine/description/?envType=study-plan-v2&envId=top-sql-50

# SQL Step-by-Step Execution: Average Process Time per Machine

---

select a1. machine_id, round(avg(a2.timestamp - a1.timestamp),3) as processing_time
from (select * from Activity where activity_type='start') a1
join (select * from Activity where activity_type='end') a2
on a1.machine_id = a2.machine_id and a1.process_id = a2.process_id 
group by a1.machine_id;
;

## Input: Activity Table

| machine_id | process_id | activity_type | timestamp |
|------------|------------|---------------|-----------|
| 0          | 0          | start         | 0.712     |
| 0          | 0          | end           | 1.520     |
| 0          | 1          | start         | 3.140     |
| 0          | 1          | end           | 4.120     |
| 1          | 0          | start         | 0.550     |
| 1          | 0          | end           | 1.550     |
| 1          | 1          | start         | 0.430     |
| 1          | 1          | end           | 1.420     |
| 2          | 0          | start         | 4.100     |
| 2          | 0          | end           | 4.512     |
| 2          | 1          | start         | 2.500     |
| 2          | 1          | end           | 5.000     |

---

## Step 1 → Start Activities (a1)

| machine_id | process_id | activity_type | timestamp |
|------------|------------|---------------|-----------|
| 0          | 0          | start         | 0.712     |
| 0          | 1          | start         | 3.140     |
| 1          | 0          | start         | 0.550     |
| 1          | 1          | start         | 0.430     |
| 2          | 0          | start         | 4.100     |
| 2          | 1          | start         | 2.500     |

---

## Step 2 → End Activities (a2)

| machine_id | process_id | activity_type | timestamp |
|------------|------------|---------------|-----------|
| 0          | 0          | end           | 1.520     |
| 0          | 1          | end           | 4.120     |
| 1          | 0          | end           | 1.550     |
| 1          | 1          | end           | 1.420     |
| 2          | 0          | end           | 4.512     |
| 2          | 1          | end           | 5.000     |

---

## Step 3 → Join (start & end by machine_id + process_id)

| a1.machine_id | a1.process_id | a1.timestamp | a2.timestamp |
|---------------|---------------|--------------|--------------|
| 0             | 0             | 0.712        | 1.520        |
| 0             | 1             | 3.140        | 4.120        |
| 1             | 0             | 0.550        | 1.550        |
| 1             | 1             | 0.430        | 1.420        |
| 2             | 0             | 4.100        | 4.512        |
| 2             | 1             | 2.500        | 5.000        |

---

## Step 4 → Compute processing_time (end − start)

| machine_id | processing_time |
|------------|-----------------|
| 0          | 0.808           |
| 0          | 0.980           |
| 1          | 1.000           |
| 1          | 0.990           |
| 2          | 0.412           |
| 2          | 2.500           |

---

## Step 5 → Group by machine_id + Average

| machine_id | processing_time |
|------------|-----------------|
| 0          | 0.894           |
| 1          | 0.995           |
| 2          | 1.456           |

---

✅ **Final Answer**: The table shows the average time each machine takes to complete a process.
